<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2nd Grade Assessment with Upload - Wayside Schools</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .header {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0;
            font-size: 2.2em;
        }
        .quarter-selector {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .quarter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .quarter-tab {
            flex: 1;
            padding: 12px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .quarter-tab.active {
            background: #9c27b0;
            color: white;
        }
        .upload-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .upload-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .method-tab {
            flex: 1;
            padding: 12px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }
        .method-tab.active {
            background: #9c27b0;
            color: white;
        }
        .upload-area {
            border: 3px dashed #9c27b0;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f0ff;
            margin: 20px 0;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background: #f3e5f5;
            border-color: #7b1fa2;
        }
        .upload-area.dragover {
            background: #e1bee7;
            border-color: #6a1b9a;
        }
        .file-input {
            display: none;
        }
        .upload-btn {
            background: #9c27b0;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
        }
        .upload-btn:hover {
            background: #7b1fa2;
        }
        .manual-entry {
            display: none;
        }
        .manual-entry.active {
            display: block;
        }
        .student-input {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }
        .student-input input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .language-buttons {
            display: flex;
            gap: 5px;
        }
        .lang-btn {
            padding: 8px 16px;
            border: 2px solid #9c27b0;
            background: white;
            color: #9c27b0;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .lang-btn.active {
            background: #9c27b0;
            color: white;
        }
        .assessment-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #9c27b0;
        }
        .assessment-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
        }
        .assessment-description {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 15px;
            font-style: italic;
        }
        .level-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .level-box {
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .level-box:hover {
            background: #e9ecef;
        }
        .level-box.selected {
            background: #9c27b0;
            color: white;
            border-color: #9c27b0;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #9c27b0;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        .file-status {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .student-list-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        .student-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .student-row:last-child {
            border-bottom: none;
        }
        .groups-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        .group-card {
            background: #f8f9fa;
            border-left: 5px solid #9c27b0;
            padding: 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .group-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        .student-list {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .activity-item {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        .activity-title {
            font-weight: bold;
            color: #4a148c;
            margin-bottom: 8px;
        }
        .materials-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .progress-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9c27b0, #673ab7);
            transition: width 0.8s ease;
            border-radius: 12px;
        }
        .student-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .instructions h3 {
            color: #0066cc;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📚 2nd Grade Assessment</h1>
        <p>Reading Level Assessment with Google Sheets Upload</p>
    </div>

    <div class="quarter-selector">
        <h2>📅 Assessment Quarter</h2>
        <div class="quarter-tabs">
            <button class="quarter-tab active" onclick="selectQuarter(1)">Quarter 1</button>
            <button class="quarter-tab" onclick="selectQuarter(2)">Quarter 2</button>
            <button class="quarter-tab" onclick="selectQuarter(3)">Quarter 3</button>
            <button class="quarter-tab" onclick="selectQuarter(4)">Quarter 4</button>
        </div>
    </div>

    <div class="upload-section">
        <h2>📊 Data Entry Method</h2>
        
        <div class="upload-methods">
            <button class="method-tab active" onclick="selectMethod('upload')">
                📁 Upload Google Sheets
            </button>
            <button class="method-tab" onclick="selectMethod('manual')">
                ✏️ Manual Entry
            </button>
        </div>

        <!-- Upload Method -->
        <div id="uploadMethod" class="upload-method">
            <div class="instructions">
                <h3>📋 Google Sheets Format Required:</h3>
                <p><strong>Column A:</strong> Student Name</p>
                <p><strong>Column B:</strong> Reading Level (AA, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P)</p>
                <p><strong>Column C:</strong> Language (English or Spanish) - Optional</p>
                <p><strong>2nd Grade Goals:</strong></p>
                <ul>
                    <li><strong>Sept/Oct (BOY):</strong> Masters K+, Meets J, Approaches I, Below ≤H</li>
                    <li><strong>December (MOY):</strong> Masters L+, Meets K, Approaches J, Below ≤I</li>
                    <li><strong>March:</strong> Masters M+, Meets L, Approaches K, Below ≤J</li>
                    <li><strong>May (EOY):</strong> Masters N+, Meets M, Approaches L, Below ≤K</li>
                </ul>
            </div>

            <div class="upload-area" id="uploadArea">
                <h3>🎯 Upload Your Google Sheets File</h3>
                <p>Export your Google Sheet as CSV and drag & drop here</p>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    📂 Select CSV File
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".csv" onchange="handleFile(this.files[0])">
            </div>

            <div id="fileStatus" class="file-status">
                <p id="statusMessage"></p>
            </div>

            <div id="studentPreview" class="student-list-preview" style="display: none;">
                <h4>👥 Uploaded Students Preview:</h4>
                <div id="previewContent"></div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="importStudents()">✅ Import All Students</button>
                    <button class="btn btn-warning" onclick="clearUpload()">🔄 Clear Upload</button>
                </div>
            </div>
        </div>

        <!-- Manual Entry Method -->
        <div id="manualMethod" class="manual-entry">
            <div class="student-input">
                <input type="text" id="studentName" placeholder="Enter Student Name" style="width: 200px;">
                <div class="language-buttons">
                    <button class="lang-btn active" id="englishBtn" onclick="selectLanguage('english')">English</button>
                    <button class="lang-btn" id="spanishBtn" onclick="selectLanguage('spanish')">Spanish</button>
                </div>
            </div>

            <div class="assessment-section">
                <div class="assessment-title">📖 Current Reading Level (Fountas & Pinnell)</div>
                <div class="assessment-description">Select the student's current reading level based on formal assessment</div>
                <div class="level-selector" id="readingLevelSelector"></div>
                <div style="margin-top: 15px;">
                    <strong>Selected Level:</strong> <span id="selectedLevel">None</span>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveStudent()">💾 Save Student</button>
                <button class="btn btn-warning" onclick="clearForm()">🔄 Clear Form</button>
            </div>
        </div>

        <div class="action-buttons" style="margin-top: 30px;">
            <button class="btn btn-success" onclick="generateGroups()">🎯 Create Groups</button>
            <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
        </div>

        <div id="savedStudents"></div>
    </div>

    <div class="groups-section" id="groupsSection">
        <h2>👥 Guided Reading Groups</h2>
        <div id="groupsContainer"></div>
    </div>

    <div class="progress-section">
        <h2>📊 Class Reading Progress</h2>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <p id="progressText">Class reading level distribution</p>
        <div id="studentProgress"></div>
    </div>

    <script>
        let currentQuarter = 1;
        let currentLanguage = 'english';
        let selectedReadingLevel = null;
        let uploadedData = [];
        let students = JSON.parse(localStorage.getItem('secondGradeAssessment') || '{}');
        
        // Updated reading levels for 2nd grade (includes AA and higher levels)
        const readingLevels = ['AA', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P'];

        // Drag and drop functionality
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });

        function init() {
            createReadingLevelSelector();
            displaySavedStudents();
            updateProgress();
        }

        function selectQuarter(quarter) {
            currentQuarter = quarter;
            document.querySelectorAll('.quarter-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.quarter-tab')[quarter-1].classList.add('active');
            displaySavedStudents();
            updateProgress();
        }

        function selectMethod(method) {
            document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
            
            if (method === 'upload') {
                document.querySelector('.method-tab').classList.add('active');
                document.getElementById('uploadMethod').style.display = 'block';
                document.getElementById('manualMethod').classList.remove('active');
            } else {
                document.querySelectorAll('.method-tab')[1].classList.add('active');
                document.getElementById('uploadMethod').style.display = 'none';
                document.getElementById('manualMethod').classList.add('active');
            }
        }

        function selectLanguage(language) {
            currentLanguage = language;
            document.getElementById('englishBtn').classList.toggle('active', language === 'english');
            document.getElementById('spanishBtn').classList.toggle('active', language === 'spanish');
        }

        function createReadingLevelSelector() {
            const selector = document.getElementById('readingLevelSelector');
            selector.innerHTML = '';
            
            readingLevels.forEach(level => {
                const levelBox = document.createElement('div');
                levelBox.className = 'level-box';
                levelBox.textContent = level;
                levelBox.onclick = () => selectReadingLevel(level, levelBox);
                selector.appendChild(levelBox);
            });
        }

        function selectReadingLevel(level, element) {
            document.querySelectorAll('.level-box').forEach(box => box.classList.remove('selected'));
            element.classList.add('selected');
            selectedReadingLevel = level;
            document.getElementById('selectedLevel').textContent = level;
        }

        function handleFile(file) {
            if (!file) return;
            
            if (!file.name.endsWith('.csv')) {
                showStatus('Please upload a CSV file exported from Google Sheets.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    parseCSV(e.target.result);
                } catch (error) {
                    showStatus('Error reading file. Please check the format.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            uploadedData = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const columns = line.split(',');
                    const studentName = columns[0]?.trim().replace(/"/g, '');
                    const readingLevel = columns[1]?.trim().replace(/"/g, '');
                    const language = columns[2]?.trim().replace(/"/g, '') || 'English';
                    
                    if (studentName && readingLevel) {
                        if (readingLevels.includes(readingLevel)) {
                            uploadedData.push({
                                name: studentName,
                                readingLevel: readingLevel,
                                language: language.toLowerCase()
                            });
                        }
                    }
                }
            }

            if (uploadedData.length > 0) {
                showStatus(`Successfully parsed ${uploadedData.length} students from CSV file.`, 'success');
                displayPreview();
            } else {
                showStatus('No valid student data found. Please check your CSV format.', 'error');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('fileStatus');
            const statusMessage = document.getElementById('statusMessage');
            
            statusDiv.style.display = 'block';
            statusDiv.className = `file-status status-${type}`;
            statusMessage.textContent = message;
        }

        function displayPreview() {
            const preview = document.getElementById('studentPreview');
            const content = document.getElementById('previewContent');
            
            let html = '';
            uploadedData.forEach((student, index) => {
                html += `
                    <div class="student-row">
                        <div>
                            <strong>${student.name}</strong> 
                            <span style="color: #666;">(${student.language})</span>
                        </div>
                        <div>
                            <span style="background: #9c27b0; color: white; padding: 4px 8px; border-radius: 4px;">
                                Level ${student.readingLevel}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
            preview.style.display = 'block';
        }

        function importStudents() {
            let importCount = 0;
            
            uploadedData.forEach(studentData => {
                const studentKey = `Q${currentQuarter}_${studentData.language}`;
                
                if (!students[studentData.name]) {
                    students[studentData.name] = {};
                }
                
                students[studentData.name][studentKey] = {
                    language: studentData.language,
                    readingLevel: studentData.readingLevel
                };
                
                importCount++;
            });

            localStorage.setItem('secondGradeAssessment', JSON.stringify(students));
            
            showStatus(`Successfully imported ${importCount} students!`, 'success');
            clearUpload();
            displaySavedStudents();
            updateProgress();
        }

        function clearUpload() {
            uploadedData = [];
            document.getElementById('studentPreview').style.display = 'none';
            document.getElementById('fileStatus').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }

        function saveStudent() {
            const name = document.getElementById('studentName').value.trim();
            if (!name) {
                alert('Please enter student name');
                return;
            }
            if (!selectedReadingLevel) {
                alert('Please select a reading level');
                return;
            }

            const studentData = {
                language: currentLanguage,
                readingLevel: selectedReadingLevel
            };

            if (!students[name]) {
                students[name] = {};
            }
            
            students[name][`Q${currentQuarter}_${currentLanguage}`] = studentData;
            localStorage.setItem('secondGradeAssessment', JSON.stringify(students));
            
            alert(`${name} assessment saved successfully!`);
            clearForm();
            displaySavedStudents();
            updateProgress();
        }

        function clearForm() {
            document.getElementById('studentName').value = '';
            document.querySelectorAll('.level-box').forEach(box => box.classList.remove('selected'));
            selectedReadingLevel = null;
            document.getElementById('selectedLevel').textContent = 'None';
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all student data? This cannot be undone.')) {
                students = {};
                localStorage.setItem('secondGradeAssessment', JSON.stringify(students));
                displaySavedStudents();
                updateProgress();
                alert('All data cleared successfully.');
            }
        }

        function displaySavedStudents() {
            const container = document.getElementById('savedStudents');
            const quarterKey = `Q${currentQuarter}_${currentLanguage}`;
            
            const studentsThisQuarter = Object.keys(students).filter(name => 
                students[name][quarterKey]
            );

            if (studentsThisQuarter.length === 0) {
                container.innerHTML = '<p>No students assessed for this quarter/language yet.</p>';
                return;
            }

            let html = '<h3>📋 Current Students:</h3>';
            studentsThisQuarter.forEach(name => {
                const data = students[name][quarterKey];
                
                html += `
                    <div class="student-summary">
                        <strong>${name}</strong> (${data.language})
                        <br><strong>Reading Level:</strong> ${data.readingLevel}
                        <button class="btn btn-warning" onclick="editStudent('${name}')" style="margin-top: 10px; padding: 5px 10px;">✏️ Edit</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function editStudent(name) {
            const quarterKey = `Q${currentQuarter}_${currentLanguage}`;
            const data = students[name][quarterKey];
            
            selectMethod('manual');
            
            document.getElementById('studentName').value = name;
            
            const levelIndex = readingLevels.indexOf(data.readingLevel);
            if (levelIndex >= 0) {
                const levelBox = document.querySelectorAll('.level-box')[levelIndex];
                selectReadingLevel(data.readingLevel, levelBox);
            }
        }

        function generateGroups() {
            const quarterKey = `Q${currentQuarter}_${currentLanguage}`;
            const levelGroups = {};
            
            Object.keys(students).forEach(name => {
                const data = students[name][quarterKey];
                if (data) {
                    const level = data.readingLevel;
                    if (!levelGroups[level]) {
                        levelGroups[level] = [];
                    }
                    levelGroups[level].push(name);
                }
            });

            const container = document.getElementById('groupsContainer');
            const section = document.getElementById('groupsSection');
            
            let html = '<h3>📚 2nd Grade Guided Reading Groups</h3>';
            let hasGroups = false;
            
            Object.keys(levelGroups).forEach(level => {
                const studentList = levelGroups[level];
                if (studentList.length >= 1) {
                    hasGroups = true;
                    html += `
                        <div class="group-card">
                            <div class="group-header">Reading Level ${level} Group</div>
                            <div class="student-list">
                                <strong>Students (${studentList.length}):</strong> ${studentList.join(', ')}
                            </div>
                            <div class="activity-item">
                                <div class="activity-title">2nd Grade Guided Reading - Level ${level}</div>
                                <p><strong>Focus:</strong> Advanced reading comprehension, fluency development, and critical thinking at Level ${level}</p>
                                <div class="materials-box">
                                    <strong>📦 Materials:</strong> Level ${level} guided reading books, comprehension graphic organizers, fluency passages, vocabulary activities, writing response journals
                                </div>
                                <p><strong>💡 2nd Grade Reading Strategies:</strong></p>
                                <ul>
                                    <li>Advanced decoding and multi-syllabic word strategies</li>
                                    <li>Reading with fluency, expression, and appropriate pacing</li>
                                    <li>Making inferences and drawing conclusions</li>
                                    <li>Summarizing and identifying main ideas</li>
                                    <li>Character analysis and plot development</li>
                                    <li>Comparing and contrasting texts</li>
                                    <li>Using text evidence to support responses</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            });

            if (!hasGroups) {
                html += '<p>No students assessed yet.</p>';
            }

            container.innerHTML = html;
            section.style.display = 'block';
        }

        function updateProgress() {
            const quarterKey = `Q${currentQuarter}_${currentLanguage}`;
            const levelCounts = {};
            let totalStudents = 0;

            Object.keys(students).forEach(name => {
                const data = students[name][quarterKey];
                if (data) {
                    totalStudents++;
                    const level = data.readingLevel;
                    levelCounts[level] = (levelCounts[level] || 0) + 1;
                }
            });

            let totalLevelPoints = 0;
            Object.keys(levelCounts).forEach(level => {
                const levelIndex = readingLevels.indexOf(level);
                totalLevelPoints += levelIndex * levelCounts[level];
            });

            const averageLevel = totalStudents > 0 ? totalLevelPoints / totalStudents : 0;
            const percentage = Math.round((averageLevel / (readingLevels.length - 1)) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = 
                `Average class level: ${totalStudents > 0 ? readingLevels[Math.round(averageLevel)] : 'No data'} (${totalStudents} students assessed)`;

            const progressContainer = document.getElementById('studentProgress');
            
            if (totalStudents > 0) {
                let progressHtml = '<h3>📈 Reading Level Distribution:</h3>';
                readingLevels.forEach(level => {
                    const count = levelCounts[level] || 0;
                    if (count > 0) {
                        progressHtml += `
                            <div class="student-summary">
                                <strong>Level ${level}:</strong> ${count} student${count > 1 ? 's' : ''}
                            </div>
                        `;
                    }
                });
                progressContainer.innerHTML = progressHtml;
            } else {
                progressContainer.innerHTML = '<p>No assessment data available for this quarter/language.</p>';
            }
        }

        window.onload = init;
    </script>
</body>
</html>
